import{c as C}from"./chunk-OTD7MV33-qJr9DjGl.js";import{c as H,r as W}from"./docs-layout-Ce5CccAJ.js";import{s as Q,g as v,l as M}from"./serialization-B1mqaFkv.js";import"./chunk-OIYGIGL5-BFuAKb0n.js";import"./index-BjhdOWXv.js";import"./index-Cx3IAmE2.js";import"./index-lnR2ABT4.js";import"./index-BNxrls_M.js";import"./Combination-Dzs_BIEW.js";const L=new Map;async function P({from:u="/api/search",initOrama:c=s=>H({schema:{_:"string"},language:s})}){const s=u,d=L.get(s);if(d)return d;async function h(){const w=await fetch(u);if(!w.ok)throw new Error(`failed to fetch exported search indexes from ${u}, make sure the search database is exported and available for client.`);const y=await w.json(),f=new Map;if(y.type==="i18n")return await Promise.all(Object.entries(y.data).map(async([m,b])=>{const e=await c(m);M(e,b),f.set(m,{db:e})})),f;const S=await c();return M(S,y),f.set("",{db:S}),f}const g=h();return L.set(s,g),g}async function U(u,c){const{tag:s,locale:d}=c,h=(await P(c)).get(d??"");return h?j(h.db,u,s):[]}async function j(u,c,s=[],{mode:d="fulltext",...h}={}){typeof s=="string"&&(s=[s]);let g={...h,mode:d,where:W({tags:s.length>0?{containsAll:s}:void 0,...h.where}),groupBy:{properties:["page_id"],maxResult:8,...h.groupBy}};c.length>0&&(g={...g,term:c,properties:d==="fulltext"?["content"]:["content","embeddings"]});const w=C(c),y=await Q(u,g),f=(e,r)=>{const a=e.toLowerCase(),t=r.toLowerCase().split(/\s+/).filter(n=>n.length>0);if(t.length<3)return 0;let o=0;for(let n=0;n<=t.length-3;n++)for(let l=3;l<=t.length-n;l++){const p=t.slice(n,n+l).join(" ");a.includes(p)&&(o=Math.max(o,l))}return o>=3?1e4+(o-3)*5e3:0},S=(e,r)=>{const a=e.toLowerCase(),i=r.toLowerCase();return a===i?1e3:a.startsWith(i+" ")?500:a.startsWith(i)?400:new RegExp(`\\b${i}\\b`,"i").test(e)?300:a.includes(i)?100:0},m=[];for(const e of y.groups??[]){const r=e.values[0],a=v(u,r);if(!a)continue;const t=e.result.find(p=>p.document.type==="page")?.score||0;let o=0,n=0;for(const p of e.result){const x=f(p.document.content,c),B=S(p.document.content,c);x>o&&(o=x),B>n&&(n=B)}const l=n+o;m.push({pageId:r,pageScore:t,matchQuality:n,phraseBoost:o,totalScore:l,page:a,hits:e.result})}m.sort((e,r)=>e.totalScore!==r.totalScore?r.totalScore-e.totalScore:r.pageScore-e.pageScore);const b=[];for(const{pageId:e,page:r,hits:a}of m){b.push({id:e,type:"page",content:r.content,breadcrumbs:r.breadcrumbs,contentWithHighlights:w.highlight(r.content),url:r.url});const i=[...a].filter(t=>t.document.type!=="page").map(t=>{const o=t.document.type==="heading"?2:1,n=S(t.document.content,c),l=f(t.document.content,c),p=n+l;return{hit:t,typeScore:o,matchQuality:n,phraseBoost:l,totalScore:p}}).sort((t,o)=>t.totalScore!==o.totalScore?o.totalScore-t.totalScore:t.typeScore!==o.typeScore?o.typeScore-t.typeScore:o.hit.score-t.hit.score).map(t=>t.hit);for(const t of i)b.push({id:t.document.id.toString(),content:t.document.content,breadcrumbs:t.document.breadcrumbs,contentWithHighlights:w.highlight(t.document.content),type:t.document.type,url:t.document.url})}return b}export{U as search,j as searchAdvanced};
