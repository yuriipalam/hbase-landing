import{r as b}from"./chunk-ZMWYLUDP-oajMeTFk.js";import{c as g}from"./chunk-OTD7MV33-qJr9DjGl.js";import{s as f,g as y,l as p}from"./serialization-B1mqaFkv.js";import{c as w}from"./docs-layout-Ce5CccAJ.js";import"./chunk-OIYGIGL5-BFuAKb0n.js";import"./index-BjhdOWXv.js";import"./index-Cx3IAmE2.js";import"./index-lnR2ABT4.js";import"./index-BNxrls_M.js";import"./Combination-Dzs_BIEW.js";async function x(o,e,t={}){const i=g(e);return(await f(o,{term:e,tolerance:1,...t,boost:{title:2,..."boost"in t?t.boost:void 0}})).hits.map(n=>({type:"page",content:n.document.title,breadcrumbs:n.document.breadcrumbs,contentWithHighlights:i.highlight(n.document.title),id:n.document.url,url:n.document.url}))}async function v(o,e,t=[],{mode:i="fulltext",...r}={}){typeof t=="string"&&(t=[t]);let n={...r,mode:i,where:b({tags:t.length>0?{containsAll:t}:void 0,...r.where}),groupBy:{properties:["page_id"],maxResult:8,...r.groupBy}};e.length>0&&(n={...n,term:e,properties:i==="fulltext"?["content"]:["content","embeddings"]});const l=g(e),u=await f(o,n),s=[];for(const d of u.groups??[]){const h=d.values[0],a=y(o,h);if(a){s.push({id:h,type:"page",content:a.content,breadcrumbs:a.breadcrumbs,contentWithHighlights:l.highlight(a.content),url:a.url});for(const c of d.result)c.document.type!=="page"&&s.push({id:c.document.id.toString(),content:c.document.content,breadcrumbs:c.document.breadcrumbs,contentWithHighlights:l.highlight(c.document.content),type:c.document.type,url:c.document.url})}}return s}var m=new Map;async function B({from:o="/api/search",initOrama:e=t=>w({schema:{_:"string"},language:t})}){const t=o,i=m.get(t);if(i)return i;async function r(){const l=await fetch(o);if(!l.ok)throw new Error(`failed to fetch exported search indexes from ${o}, make sure the search database is exported and available for client.`);const u=await l.json(),s=new Map;if(u.type==="i18n")return await Promise.all(Object.entries(u.data).map(async([h,a])=>{const c=await e(h);p(c,a),s.set(h,{type:a.type,db:c})})),s;const d=await e();return p(d,u),s.set("",{type:u.type,db:d}),s}const n=r();return m.set(t,n),n}async function k(o,e){const{tag:t,locale:i}=e,r=(await B(e)).get(i??"");return r?r.type==="simple"?x(r,o):v(r.db,o,t):[]}export{k as search};
