import{c as Q}from"./chunk-OTD7MV33-qJr9DjGl.js";import{c as S,r as x}from"./docs-layout-olRaKt0f.js";import{s as H,g as W,l as y}from"./serialization-DUYLYDmB.js";import"./chunk-OIYGIGL5-BFuAKb0n.js";import"./index-BjhdOWXv.js";import"./index-Cx3IAmE2.js";import"./index-lnR2ABT4.js";import"./index-BNxrls_M.js";import"./Combination-Dzs_BIEW.js";const w=new Map;async function B({from:a="/api/search",initOrama:c=r=>S({schema:{_:"string"},language:r})}){const r=a,u=w.get(r);if(u)return u;async function s(){const g=await fetch(a);if(!g.ok)throw new Error(`failed to fetch exported search indexes from ${a}, make sure the search database is exported and available for client.`);const f=await g.json(),h=new Map;if(f.type==="i18n")return await Promise.all(Object.entries(f.data).map(async([d,n])=>{const e=await c(d);y(e,n),h.set(d,{db:e})})),h;const m=await c();return y(m,f),h.set("",{db:m}),h}const l=s();return w.set(r,l),l}async function R(a,c){const{tag:r,locale:u}=c,s=(await B(c)).get(u??"");return s?v(s.db,a,r):[]}async function v(a,c,r=[],{mode:u="fulltext",...s}={}){typeof r=="string"&&(r=[r]);let l={...s,mode:u,where:x({tags:r.length>0?{containsAll:r}:void 0,...s.where}),groupBy:{properties:["page_id"],maxResult:8,...s.groupBy}};c.length>0&&(l={...l,term:c,properties:u==="fulltext"?["content"]:["content","embeddings"]});const g=Q(c),f=await H(a,l),h=(n,e)=>{const o=n.toLowerCase(),i=e.toLowerCase();return o===i?1e3:o.startsWith(i+" ")?500:o.startsWith(i)?400:new RegExp(`\\b${i}\\b`,"i").test(n)?300:o.includes(i)?100:0},m=[];for(const n of f.groups??[]){const e=n.values[0],o=W(a,e);if(!o)continue;const t=n.result.find(b=>b.document.type==="page")?.score||0,p=h(o.content,c);m.push({pageId:e,pageScore:t,matchQuality:p,page:o,hits:n.result})}m.sort((n,e)=>n.matchQuality!==e.matchQuality?e.matchQuality-n.matchQuality:e.pageScore-n.pageScore);const d=[];for(const{pageId:n,page:e,hits:o}of m){d.push({id:n,type:"page",content:e.content,breadcrumbs:e.breadcrumbs,contentWithHighlights:g.highlight(e.content),url:e.url});const i=[...o].filter(t=>t.document.type!=="page").map(t=>({hit:t,typeScore:t.document.type==="heading"?2:1,matchQuality:h(t.document.content,c)})).sort((t,p)=>t.typeScore!==p.typeScore?p.typeScore-t.typeScore:t.matchQuality!==p.matchQuality?p.matchQuality-t.matchQuality:p.hit.score-t.hit.score).map(t=>t.hit);for(const t of i)d.push({id:t.document.id.toString(),content:t.document.content,breadcrumbs:t.document.breadcrumbs,contentWithHighlights:g.highlight(t.document.content),type:t.document.type,url:t.document.url})}return d}export{R as search,v as searchAdvanced};
